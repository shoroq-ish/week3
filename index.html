<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.google.com/specimen/Nunito+Sans" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css"
        integrity="sha512-YWzhKL2whUzgiheMoBFwW8CKV4qpHQAEuvilg9FAn5VJUDwKZZxkJNuGM4XkWuk94WCrrwslk8yWNGmY1EduTA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <meta charset="utf-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="index.css">

</head>


<body>
    <header class="m-0 pt-2 shadow-sm position-fixed w-100 ">

        <div class="d-flex justify-content-between container ">
            <div class="elem1">Where in the world?</div>
            <div class="elem2 pt-1"  id="darkMode"><i class="fa-regular fa-moon"></i>Dark Mode</div>

        </div>
    </header>
    <main class="pb-5 container">
        <div class="d-flex justify-content-between  div2">
            <div class=" position-relative Search shadow-sm rounded">
                <i class="fa-solid fa-magnifying-glass position-absolute ps-4"></i>
                <input placeholder="Search for a country..." class=" w-100 h-100 border-0 rounded" id="search">
            </div>
            <div class="drop dropdown ">
                <button class=" small shadow-sm  rounded pe-3  ps-3  pt-3 pb-3  border-0 dropdown-toggle "
                    type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                    Filter by Region
                    <i class="fa-solid fa-angle-down ps-5"></i>
                </button>
                <ul id="continents" class=" shadow-sm dropdown-menu w-100 border-0 dropdown-list"
                    aria-labelledby="dropdownMenuButton1">

                </ul>
            </div>

        </div>
        <div>
            <div class=" row  gy-5 gx-5  mt-5 px-sm-5 px-md-0" id="shorouq"></div>
        </div>
        <script>
            let cards = [];
            let allData = [];
            let filterCountry = [];
            let filterFlag=0;
            let filtertext ="";
            let searchvalue ="";
            

            getData();


            const search = document.getElementById("search");
            search.addEventListener("input", (e) => {
                 searchvalue = e.target.value;
                // let arr = [5,6,3,6]

                filterCountry = allData.filter((country) => {
                    if(filtertext== "all" || filtertext==""){
                        return country.name.common.toLowerCase().includes(searchvalue);
                    }
                    else{
                        return country.name.common.toLowerCase().includes(searchvalue) 
                        && country.region.includes(filtertext);
                    }
                    
                });
                // document.getElementById("shorouq").innerHTML = '';
                getData();
                // console.log(filterCountry);


            });


            // const element= document.querySelector("[country-card]");
            function goDetails(id) {
                localStorage.setItem("id", id);
                // console.log(filterCountry);
                localStorage.setItem("filterCountry", JSON.stringify(filterCountry));
                location.href = 'details.html';
            }


            function getData() {
                fetch('https://restcountries.com/v3.1/all')
                    .then((response) => response.json())
                    .then((data) => {
                        allData = data;
                        let key = 0;
                        if (search.value == "" && (filterFlag !=1 || filterFlag=="all")) {
                            filterCountry = data;
                        }
                        console.log(filterCountry);
                        const htmlString = filterCountry
                        .map((country)=>{
                            return '<div class="col-12 col-md-4 col-lg-3">' +
                                '<a href="#" class="w-100" onclick="goDetails(' + key++ + ')">' +
                                '<div class="shadow-sm  p-0 rounded card ">' +

                                '      <img src="' + country.flags.svg + '" alt="flag1" class="w-100 rounded-top">' +
                                '     <div class=" mt-4 ms-4 pb-5 ">' +
                                '        <div class="country mb-3">' + country.name.common + '</div>' +
                                '       <div>' +
                                '          <div class="row-detail"><span class="property">Population:</span>' +
                                '                 <span class="ps-1 value">' + country.population + '</span></div>' +
                                '        <div class="row-detail"><span class="property">Region:</span>' +
                                '              <span class="ps-1 value">' + country.region + '</span></div>' +
                                '      <div class="row-detail"><span class="property">Capital:</span>' +
                                '            <span class="ps-1 value">' + country.capital + '</span></div>' +
                                '</div></div></div></div></a></div>';
                        }).join('');
                        document.getElementById("shorouq").innerHTML = htmlString;
                               
                    }
                    );
            }


            //filter drop down list
            function filter(obj) {
                filterFlag =1;
                filtertext = obj.textContent;
                console.log(filtertext);
                if(filtertext != "all"){
                filterCountry = allData.filter((country) => {
                    if(search.value == ""){
                       return country.region.includes(filtertext); 
                    }else{
                        return country.name.common.toLowerCase().includes(searchvalue) 
                        && country.region.includes(filtertext);
                    }
                    
                });
                console.log(filterCountry);
                console.log("filterCountry");
            }
            else{
                filterFlag = "all";
            }

                // document.getElementById("shorouq").innerHTML = '';
                getData();

                
            }
            

            let continents = ["Africa", "America", "Asia", "Europe", "Oceania","all"];
            for (let continent of continents) {
                // console.log(continent);
                document.getElementById("continents").innerHTML +=
                    '<li class="dropdown-item small" ><a href="#" onclick="filter(this)">' + continent + '</a></li>';
            }

            //Dark Mode
            let darkMode = document.getElementById("darkMode");
            darkMode.onclick = function(){
                document.body.classList.toggle("dark-mode");
            }            


        </script>


        
    </main>

</body>

</html>